$(function(){var n=$("#subtitle-input-1"),p=$("#subtitle-input-2"),i=$("#video-input-1"),l=$("#video-input-2"),u=n.add(p).add(i).add(l),d=$("#offset-input"),s=$("#factor-input");function toDisplayTime(t){return(0<=t?"":"-")+Subtitle.toSrtTime(Math.abs(t)).replace(",",".")}function fromDisplayTime(t,e){var a=t.substr(0,1);switch(a){case"+":case"-":a="+"==a?1:-1,t=t.substr(1);break;default:a=1}if(!e&&a<0)throw new Error("Negative values are not allowed.");return a*Subtitle.toMS(t)}function update(t,e){d.prop("parsedValue",t).val(toDisplayTime(t)),s.prop("parsedValue",e).val(e)}u.prop("parsedValue",0).val(toDisplayTime(0)),update(0,1),u.on("change",function(t){t.preventDefault(),t.stopPropagation(),$target=$(t.target);try{$target.prop("parsedValue",fromDisplayTime($target.val()))}catch(t){}$target.val(toDisplayTime($target.prop("parsedValue"))),u.parent().removeClass("has-error");var e,t=n.prop("parsedValue"),a=p.prop("parsedValue"),r=i.prop("parsedValue"),o=l.prop("parsedValue");0!=t||0!=a||0!=r||0!=o?(o=o-r,0<(a=a-t)&&0<o?(e=o/a,update(Math.round(e*-t+r),e)):(a<=0&&0==$target.attr("id").indexOf("subtitle")||o<=0&&0==$target.attr("id").indexOf("video"))&&$target.parent().addClass("has-error")):update(0,1)}),d.on("change",function(t){t.preventDefault(),t.stopPropagation(),$target=$(t.target);try{$target.prop("parsedValue",fromDisplayTime($target.val(),!0))}catch(t){}$target.val(toDisplayTime($target.prop("parsedValue")))}),s.on("change",function(t){t.preventDefault(),t.stopPropagation(),$target=$(t.target);t=new Number($target.val());isNaN(t)||$target.prop("parsedValue",t),$target.val(t)});var f=$("#input-text"),v=$("#output-text"),t=$("#adjust-button"),c=$("#download-button");t.on("click",function(t){t.preventDefault(),t.stopPropagation(),c.attr("disabled",!0);t=f.val();if(t){try{var e=Subtitle.parse(t)}catch(t){return v.val("Input text doesn't seem to have a valid SRT format."),void console.log(t)}for(var a=d.prop("parsedValue"),r=s.prop("parsedValue"),o=0;o<e.length;o++){var n=e[o];n.start=adjust(n.start),n.end=adjust(n.end)}v.val(Subtitle.stringify(e)),c.removeAttr("disabled")}else v.val("");function adjust(t){return Math.round(r*t+a)}}),c.on("click",function(t){t.preventDefault(),t.stopPropagation();var t=v.val(),e=document.createElement("a"),t=new Blob(["\ufeff",t],{type:"text/plain"});e.href=URL.createObjectURL(t);try{var a=f.prop("fileName")||"subtitle.srt";(parts=a.split(".")).splice(parts.length-1,0,"fixed"),a=parts.join("."),e.download=a,e.classList.add("hidden"),document.body.appendChild(e);try{e.click()}finally{document.body.removeChild(e)}}finally{URL.revokeObjectURL(e.href)}}),window.File&&window.FileReader&&window.FileList&&window.Blob&&(f.on("dragover",function(t){t.stopPropagation(),t.preventDefault(),(t=t.originalEvent).dataTransfer.dropEffect="copy"}),f.on("drop",function(t){t.stopPropagation(),t.preventDefault();var e=(t=t.originalEvent).dataTransfer.files;e.length&&((t=new FileReader).onload=function(t){f.prop("fileName",e[0].name),f.val(t.target.result)},t.readAsText(e[0]))}),f.on("change",function(t){t.stopPropagation(),t.preventDefault(),f.prop("fileName",null)}))});